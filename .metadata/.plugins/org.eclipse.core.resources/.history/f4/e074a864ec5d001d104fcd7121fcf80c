-- maboutique.categorie definition

-- Drop table

-- DROP TABLE maboutique.categorie;

CREATE TABLE maboutique.categorie (
	id int4/9 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	nom varchar(50) NOT NULL,
	CONSTRAINT categorie_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE maboutique.categorie OWNER TO postgres;
GRANT ALL ON TABLE maboutique.categorie TO postgres;
GRANT ALL ON TABLE maboutique.categorie TO maboutique;


-- maboutique.utilisateur definition

-- Drop table

-- DROP TABLE maboutique.utilisateur;

CREATE TABLE maboutique.utilisateur (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	nom varchar(50) NOT NULL,
	prenom varchar(50) NOT NULL,
	email varchar(50) NOT NULL,
	motdepasse varchar(50) NOT NULL,
	"admin" bool NOT NULL,
	CONSTRAINT utilisateur_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE maboutique.utilisateur OWNER TO postgres;
GRANT ALL ON TABLE maboutique.utilisateur TO postgres;
GRANT ALL ON TABLE maboutique.utilisateur TO maboutique;


-- maboutique.produit definition

-- Drop table

-- DROP TABLE maboutique.produit;

CREATE TABLE maboutique.produit (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	nom varchar(50) NOT NULL,
	prix float8 NOT NULL,
	idcategorie int4 NOT NULL,
	idvendeur int4 NOT NULL,
	idacheteur int4 NULL,
	statut bpchar(1) NOT NULL DEFAULT 'D'::bpchar,
	quantité int4 NOT NULL DEFAULT 0,
	CONSTRAINT produit_pkey PRIMARY KEY (id),
	CONSTRAINT produit_statut_check CHECK ((statut = ANY (ARRAY['D'::bpchar, 'C'::bpchar, 'V'::bpchar]))),
	CONSTRAINT produit_idacheteur_fkey FOREIGN KEY (idacheteur) REFERENCES maboutique.utilisateur(id),
	CONSTRAINT produit_idcategorie_fkey FOREIGN KEY (idcategorie) REFERENCES maboutique.categorie(id),
	CONSTRAINT produit_idvendeur_fkey FOREIGN KEY (idvendeur) REFERENCES maboutique.utilisateur(id)
);

-- Permissions

ALTER TABLE maboutique.produit OWNER TO postgres;
GRANT ALL ON TABLE maboutique.produit TO postgres;
GRANT ALL ON TABLE maboutique.produit TO maboutique;


-- maboutique.historiqueachat definition

-- Drop table

-- DROP TABLE maboutique.historiqueachat;

CREATE TABLE maboutique.historiqueachat (
	id int4 NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	quantite int4 NOT NULL,
	idproduit int4 NOT NULL,
	idacheteur int4 NOT NULL,
	CONSTRAINT historiqueachat_pkey PRIMARY KEY (id),
	CONSTRAINT historiqueachat_idacheteur_fkey FOREIGN KEY (idacheteur) REFERENCES maboutique.utilisateur(id),
	CONSTRAINT historiqueachat_idproduit_fkey FOREIGN KEY (idproduit) REFERENCES maboutique.produit(id)
);

-- Permissions

ALTER TABLE maboutique.historiqueachat OWNER TO postgres;
GRANT ALL ON TABLE maboutique.historiqueachat TO postgres;
GRANT ALL ON TABLE maboutique.historiqueachat TO maboutique;

INSERT INTO maboutique.utilisateur (nom,prenom,email,motdepasse,"admin") VALUES
	 ('Durand','Pierre','pdurand@3il.fr','pdurand',false),
	 ('Salim','Ali','asalim@3il.fr','asalim',false),
	 ('Admin','Admin','admin@3il.fr','admin',true);

INSERT INTO maboutique.categorie (nom) VALUES
	 ('informatique'),
	 ('consommable'),
	 ('bureautique');

INSERT INTO maboutique.produit (nom,prix,idcategorie,idvendeur,idacheteur,statut,quantité) VALUES
	 ('Carte graphique RTX',120.0,1,3,1,'C',0),
	 ('Clavier optique',65.26,2,3,1,'D',4),
	 ('Nintendo Switch',500.0,1,2,3,'C',0),
	 ('Souris sans fil',15.0,1,1,3,'D',77),
	 ('Tablette graphique',152.0,1,1,3,'D',15),
	 ('Cartouches d''encre',35.0,1,2,3,'D',5),
	 ('Ecran 21"',123.0,1,1,3,'D',5),
	 ('Ecran 19"',99.0,2,1,3,'C',5),
	 ('Stylo bille noir',3.5,2,1,3,'D',2);

INSERT INTO maboutique.historiqueachat (quantite,idproduit,idacheteur) VALUES
	 (6,10,3),
	 (1,10,3),
	 (1,9,3),
	 (2,11,1),
	 (2,3,1),
	 (2,11,1),
	 (2,3,1),
	 (2,9,3),
	 (2,9,3),
	 (2,4,3);