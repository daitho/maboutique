-- Schema



DROP SCHEMA  IF EXISTS  maboutique  CASCADE;
CREATE SCHEMA  maboutique;



SET search_path TO maboutique, public;




-- Tables et vues




CREATE TABLE utilisateur (
    id                INT                NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nom                VARCHAR(50)        NOT NULL,
    prenom            VARCHAR(50)        NOT NULL,
    email            VARCHAR(50)        NOT NULL,
    motdepasse        VARCHAR(50)        NOT NULL,
    admin            BOOLEAN            NOT NULL,
    PRIMARY KEY (id)
);



CREATE TABLE categorie (
    id                INT                NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nom                VARCHAR(50)     NOT NULL,
    PRIMARY KEY (id)
);



CREATE TABLE produit (
    id                INT                NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nom                VARCHAR(50)        NOT NULL,
    prix            DOUBLE PRECISION NOT NULL,
    idcategorie        INT                NOT NULL,
    idvendeur        INT                NOT NULL,
    idacheteur        INT                NULL,
    statut            CHAR(1)            NOT NULL  DEFAULT 'D',
    FOREIGN KEY (idCategorie) REFERENCES categorie (id),    
    FOREIGN KEY (idvendeur) REFERENCES utilisateur (id),    
    FOREIGN KEY (idacheteur) REFERENCES utilisateur (id),
    CHECK ( statut IN ('D', 'C', 'V') ),
    PRIMARY KEY (id)
);





-- Insertion des données



   
INSERT INTO utilisateur (id, nom, prenom, email, motdepasse, admin) VALUES
( 1, 'Durand', 'Pierre', 'pdurand@3il.fr', 'pdurand', false),
( 2, 'Salim', 'Ali', 'asalim@3il.fr', 'asalim', false),
( 3, 'Admin', 'Admin', 'admin@3il.fr', 'admin', true);



ALTER TABLE utilisateur ALTER COLUMN id RESTART WITH 4;




INSERT INTO categorie (id, nom) VALUES
(1, 'informatique'),
(2, 'bureautique');



ALTER TABLE categorie ALTER COLUMN id RESTART WITH 3;




INSERT INTO produit ( id, nom, prix, idCategorie, idvendeur ) VALUES
(  1, 'Souris sans fil', 15, 1, 1),
(  2, 'Tablette graphique', 152, 1, 1),
(  3, 'Cartouches d''encre', 35, 1, 2),
(  4, 'Nintendo Switch', 500, 1, 2),
(  5, 'Papier A4', 8, 2, 1),
(  6, 'Stylo bille noir', 3.5, 2, 1),
(  7, 'Clavier optique', 65.26, 1, 2),
(  8, 'Stylo bille bleu', 3.5, 2, 2),
(  9, 'Ecran 21"', 123, 1, 1),
( 10, 'Ecran 19"', 99, 1, 1),
( 11, 'Carte graphique RTX', 120, 1, 2),
( 12, 'Pot à crayons', 4.5, 2, 1);



ALTER TABLE produit ALTER COLUMN id RESTART WITH 13;




    
-- Compte utilisateur



DROP USER  IF EXISTS  maboutique;
CREATE USER  maboutique  WITH PASSWORD 'maboutique';
GRANT ALL PRIVILEGES ON SCHEMA maboutique TO maboutique;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA maboutique TO maboutique;